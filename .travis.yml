language: rust

rust:
  - nightly
  - beta
  - stable

matrix:
  include:
    - rust: 1.36.0
    - rust: nightly
      os: osx
    - rust: nightly
      os: windows
    - rust: nightly
      name: Cortex-M
      before_install: sudo apt-get install -y qemu-system-arm
      install: rustup target add thumbv7m-none-eabi
      script: cd tests/cortex && cargo run --release
    - rust: 1.31.0
      script: cargo check
  allow_failures:
    # macOS build temporarily disabled due to Cargo bug:
    # https://github.com/rust-lang/cargo/issues/7427
    - os: osx

script:
  - cargo test
  - cargo test --release
